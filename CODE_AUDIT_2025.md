# üîç –ê—É–¥–∏—Ç –∫–æ–¥–∞ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ SBIS Telegram Bot

**–î–∞—Ç–∞:** 13 –¥–µ–∫–∞–±—Ä—è 2025  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** GitHub Copilot  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ Python —Ñ–∞–π–ª–æ–≤:** 11
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:** ~2,350
- **–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:** 6 (bot, daily_act, ocr_gpt, catalog_lookup, compositions, income_upd)
- **–¢–µ—Å—Ç–æ–≤—ã–µ/–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ:** 5 (build_act_xml, create_act_from_xml, test_ocr_diagnosis, sbis_auth, name_matching)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 6 (python-telegram-bot, requests, pandas, openpyxl, python-dotenv, openai)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–ª–æ–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  bot_simple.py (570 —Å—Ç—Ä–æ–∫)          ‚îÇ ‚Üê Telegram UI, long-polling
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  daily_act.py (409 —Å—Ç—Ä–æ–∫)           ‚îÇ ‚Üê –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è XML
‚îÇ  income_upd.py (247 —Å—Ç—Ä–æ–∫)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ocr_gpt.py (281 —Å—Ç—Ä–æ–∫)             ‚îÇ ‚Üê AI-—Å–ª–æ–π (GPT-4, Whisper)
‚îÇ  catalog_lookup.py (159 —Å—Ç—Ä–æ–∫)      ‚îÇ ‚Üê –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ Excel
‚îÇ  compositions.py (184 —Å—Ç—Ä–æ–∫)        ‚îÇ
‚îÇ  name_matching.py (121 —Å—Ç—Ä–æ–∫)       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  sbis_auth.py (101 —Å—Ç—Ä–æ–∫)           ‚îÇ ‚Üê API-—Å–ª–æ–π –°–ë–ò–°
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö:
1. **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ/–°–ø–∏—Å–∞–Ω–∏–µ:** –§–æ—Ç–æ ‚Üí OCR ‚Üí –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º ‚Üí XML ‚Üí –°–ë–ò–° API
2. **–ü—Ä–∏—Ö–æ–¥:** –§–æ—Ç–æ –£–ü–î ‚Üí OCR ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ–ª–µ–π ‚Üí Income XML ‚Üí –°–ë–ò–° API
3. **–ì–æ–ª–æ—Å–æ–≤—ã–µ:** Voice ‚Üí Whisper ‚Üí GPT –∫–æ—Ä—Ä–µ–∫—Ü–∏—è ‚Üí State update

---

## ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

### 1. **–•–æ—Ä–æ—à–∞—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: UI (bot) / –õ–æ–≥–∏–∫–∞ (daily_act) / AI (ocr_gpt) / Data (catalog_lookup)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (find_best_match, calc_similarity)
- ‚úÖ –ï–¥–∏–Ω—ã–π entry point –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–∫—Ç–æ–≤ (send_any_act)

### 2. **–£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ split_valid_invalid_items() –æ—Ç–¥–µ–ª—è–µ—Ç –±–∏—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö
- ‚úÖ Fallback-–ª–æ–≥–∏–∫–∞: —Å–æ—Å—Ç–∞–≤—ã ‚Üí –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ ‚Üí –∫–∞—Ç–∞–ª–æ–≥

### 3. **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ**
- ‚úÖ –ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º: SequenceMatcher (40%) + —Ç–æ–∫–µ–Ω—ã (25%) + Levenshtein (35%)
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–µ—á–∞—Ç–æ–∫ (–ª–∞—Ç–∏–Ω–∏—Ü–∞‚Üí–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ Forced matching –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–∞—Ä ("—Ö–æ—Ç" ‚Üí "–ö–û–õ–ë–ê–°–ö–ò –û–•–û–¢–ù–ò–ß–¨–ò")

### 4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ logs/ocr_tables.log - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã OCR
- ‚úÖ logs/catalog_matching.log - —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º
- ‚úÖ –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞—É–¥–∏—Ç–∞

### 5. **–ì–∏–±–∫–æ—Å—Ç—å –≤–≤–æ–¥–∞**
- ‚úÖ –§–æ—Ç–æ —Ç–∞–±–ª–∏—Ü, –≥–æ–ª–æ—Å–æ–≤—ã–µ, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ GPT
- ‚úÖ –†–µ–∂–∏–º—ã: –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ/—Å–ø–∏—Å–∞–Ω–∏–µ/–ø—Ä–∏—Ö–æ–¥

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è build_native_xml() - 185 —Å—Ç—Ä–æ–∫**
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è XML –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏. –ù–∞—Ä—É—à–µ–Ω–∏–µ SRP (Single Responsibility Principle).

**–†–∏—Å–∫–∏:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—ã—Å–æ–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±–∞–≥–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏ –ª–æ–≥–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –†–∞–∑–±–∏—Ç—å –Ω–∞:
def _build_document_header(doc_kind, doc_date, doc_number):
    ...

def _build_company_info(inn, name):
    ...

def _build_item_table(items):
    ...

def _build_warehouse_section(doc_kind):
    ...

def build_native_xml(doc_kind, doc_date, doc_number, items):
    root = _build_document_header(...)
    _add_company_info(root, ...)
    _add_item_table(root, ...)
    if doc_kind == "writeoff":
        _add_warehouse_section(root)
    return ET.tostring(root, encoding="windows-1251")
```

### 2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ _to_float_safe() –≤ 2 —Ñ–∞–π–ª–∞—Ö**
**–ì–¥–µ:** compositions.py (31 —Å—Ç—Ä–æ–∫–∞) –∏ income_upd.py (19 —Å—Ç—Ä–æ–∫)

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å utils.py:
```python
# utils.py
def to_float_safe(value, default=0.0):
    """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ float —Å fallback."""
    if isinstance(value, (int, float)):
        return float(value)
    if isinstance(value, str):
        value = value.strip().replace(",", ".")
        try:
            return float(value)
        except ValueError:
            return default
    return default
```

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ rate limits OpenAI**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç retry-–ª–æ–≥–∏–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö 429 (Too Many Requests) –æ—Ç OpenAI.

**–†–µ—à–µ–Ω–∏–µ:**
```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=1, min=2, max=10))
def extract_doc_from_image_gpt(image_path: str):
    ...
```

### 4. **Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É**
**–ü—Ä–∏–º–µ—Ä—ã:**
- `"–ò–ü –ü–ª–µ—Ç–Ω–µ–≤"` - 3 –º–µ—Å—Ç–∞
- `"–§–∏—Ä–ª–µ—Å—Å, –û–û–û"` - 2 –º–µ—Å—Ç–∞
- `"940200200247"` - 2 –º–µ—Å—Ç–∞
- `"–ü–ª–µ—Ç–Ω–µ–≤ –°–µ—Ä–≥–µ–π –Æ—Ä—å–µ–≤–∏—á, –ò–ü, –ì–æ—Ä–æ–¥ –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å"` - 1 –º–µ—Å—Ç–æ

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å config.py:
```python
# config.py
from dataclasses import dataclass

@dataclass
class CompanyConfig:
    inn: str = "940200200247"
    name: str = "–ü–ª–µ—Ç–Ω–µ–≤ –°–µ—Ä–≥–µ–π –Æ—Ä—å–µ–≤–∏—á, –ò–ü, –ì–æ—Ä–æ–¥ –°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å"
    warehouse_name: str = "–ò–ü –ü–ª–µ—Ç–Ω–µ–≤"
    warehouse_id: str = "284"
    recipient_name: str = "–§–∏—Ä–ª–µ—Å—Å, –û–û–û"
    recipient_inn: str = "7710000001"

COMPANY = CompanyConfig()
```

### 5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç, –ò–ù–ù, –Ω–æ–º–µ—Ä–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
```python
def validate_date(date_str: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ DD.MM.YYYY"""
    try:
        datetime.strptime(date_str, "%d.%m.%Y")
        return True
    except ValueError:
        return False

def validate_inn(inn: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ò–ù–ù (10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä)"""
    return inn.isdigit() and len(inn) in (10, 12)
```

---

## ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 6. **Long-polling –≤–º–µ—Å—Ç–æ webhooks**
**–ü—Ä–æ–±–ª–µ–º–∞:** bot_simple.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç getUpdates (long-polling), —á—Ç–æ:
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –æ—Ç–≤–µ—Ç–∞
- –¢—Ä–∞—Ç–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ webhooks:
```python
from telegram.ext import Application, CommandHandler, MessageHandler

def main():
    app = Application.builder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", handle_start))
    app.add_handler(MessageHandler(filters.PHOTO, handle_photo))
    app.run_webhook(
        listen="0.0.0.0",
        port=8443,
        webhook_url=f"https://your-domain.com/{TOKEN}"
    )
```

### 7. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Excel-—Ñ–∞–π–ª–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è —á–∏—Ç–∞—é—Ç—Å—è 3 Excel —Ñ–∞–π–ª–∞ (–ö–∞—Ç–∞–ª–æ–≥, –°–æ—Å—Ç–∞–≤—ã, –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ).

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
# catalog_lookup.py
DF_CAT = pd.read_excel("–ö–∞—Ç–∞–ª–æ–≥.xlsx")  # –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ!
```

**–†–µ—à–µ–Ω–∏–µ:** Lazy loading + cache:
```python
from functools import lru_cache

@lru_cache(maxsize=1)
def get_catalog_df():
    return pd.read_excel("–ö–∞—Ç–∞–ª–æ–≥.xlsx")

DF_CAT = None

def get_catalog():
    global DF_CAT
    if DF_CAT is None:
        DF_CAT = get_catalog_df()
    return DF_CAT
```

### 8. **–ù–µ—Ç unit-—Ç–µ—Å—Ç–æ–≤**
**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –¢–æ–ª—å–∫–æ test_ocr_diagnosis.py (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç, –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å pytest:
```python
# tests/test_name_matching.py
import pytest
from name_matching import calc_similarity, find_best_match

def test_calc_similarity_exact_match():
    assert calc_similarity("–¢–ï–°–¢–û", "–¢–ï–°–¢–û") == 1.0

def test_calc_similarity_typo():
    score = calc_similarity("—Ç–µ—Å–æ", "–¢–ï–°–¢–û")
    assert 0.5 < score < 0.8

def test_find_best_match():
    items = ["–¢–ï–°–¢–û", "–¢–ï–°–¢", "–ü–ï–°–¢–û"]
    result, score = find_best_match("—Ç–µ—Å–æ", items)
    assert result == "–¢–ï–°–¢–û"
    assert score > 0.6
```

### 9. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
**–ü—Ä–æ–±–ª–µ–º–∞:** USER_STATE - –≥–ª–æ–±–∞–ª—å–Ω—ã–π dict, –Ω–æ –Ω–µ—Ç thread-safety.

**–†–µ—à–µ–Ω–∏–µ:**
```python
from threading import Lock

USER_STATE: Dict[int, Dict] = {}
STATE_LOCK = Lock()

def get_state(chat_id: int) -> Dict:
    with STATE_LOCK:
        st = USER_STATE.setdefault(chat_id, {})
        st.setdefault("items", [])
        st.setdefault("pending_confirm", False)
        st.setdefault("doc_type", "production")
        return st
```

### 10. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–π –∫–æ–¥ –≤ bot_simple.py**
**–ü—Ä–æ–±–ª–µ–º–∞:** 570 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ, –º–Ω–æ–≥–æ nested if-else.

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–¥–µ–ª–∏—Ç—å handler-—Å–ª–æ–π:
```
bot_simple.py (100 —Å—Ç—Ä–æ–∫) - main loop
handlers/
  ‚îú‚îÄ‚îÄ start_handler.py
  ‚îú‚îÄ‚îÄ photo_handler.py
  ‚îú‚îÄ‚îÄ voice_handler.py
  ‚îú‚îÄ‚îÄ text_handler.py
  ‚îî‚îÄ‚îÄ command_handler.py
```

---

## üîß –ú–µ–ª–∫–∏–µ –Ω–µ–¥–æ—á–µ—Ç—ã

### 11. **–°–º–µ—à–∏–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
```python
# –ü–ª–æ—Ö–æ:
send_message(chat_id, f"–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: {label}\n–¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫:\n" + format_items(st["items"]))

# –õ—É—á—à–µ:
message = format_document_status(label, st["items"])
send_message(chat_id, message)
```

### 12. **Magic numbers**
```python
# –ü–ª–æ—Ö–æ:
params = {"timeout": 30}
resp = requests.get(file_url, timeout=60)

# –õ—É—á—à–µ:
TELEGRAM_POLLING_TIMEOUT = 30
FILE_DOWNLOAD_TIMEOUT = 60
```

### 13. **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã**
```python
# create_act_from_xml.py
from pysaby import SABYManager  # ‚ùå –ù–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

# bot_simple.py
from copy import deepcopy  # ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–¥–µ
```

### 14. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ type hints –≤–æ –º–Ω–æ–≥–∏—Ö –º–µ—Å—Ç–∞—Ö**
```python
# –ü–ª–æ—Ö–æ:
def format_items(items):
    ...

# –•–æ—Ä–æ—à–æ:
def format_items(items: List[Dict[str, Any]]) -> str:
    ...
```

### 15. **–õ–æ–≥–∏ –≤ stderr –≤–º–µ—Å—Ç–æ proper logging**
```python
# –ü–ª–æ—Ö–æ:
import sys
print(f"[INFO] ...", file=sys.stderr)

# –õ—É—á—à–µ:
import logging
logger = logging.getLogger(__name__)
logger.info("...")
```

---

## üóëÔ∏è –ú—É—Å–æ—Ä–Ω—ã–π –∫–æ–¥ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)

### 1. **create_act_from_xml.py** (97 —Å—Ç—Ä–æ–∫)
**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–π API (pysaby), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∏–≥–¥–µ.  
**–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –∞—Ä—Ö–∏–≤.

### 2. **build_act_xml.py** (142 —Å—Ç—Ä–æ–∫–∏)
**–ü—Ä–∏—á–∏–Ω–∞:** –î—É–±–ª–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª build_native_xml() –∏–∑ daily_act.py.  
**–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ daily_act.py.

### 3. **test_ocr_diagnosis.py** (147 —Å—Ç—Ä–æ–∫)
**–ü—Ä–∏—á–∏–Ω–∞:** –≠—Ç–æ –Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç, –∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production.  
**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ tools/ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å.

### 4. **XML-—Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ** (3 —à—Ç.)
```
act_accounting.xml
act_accounting_3_nuggets.xml
act_generated.xml
ON_NSCHFDOPPR__*.xml
ON_Storage_*.xml
```
**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ archive/ –∏–ª–∏ tmp_xml/.

### 5. **.md —Ñ–∞–π–ª—ã —Å –æ—Ç—á–µ—Ç–∞–º–∏** (4 —à—Ç.)
```
IMPROVEMENTS_REPORT.md
QUICK_FIX_GUIDE.md
README_FIXES.md
SUMMARY.md
```
**–î–µ–π—Å—Ç–≤–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω CHANGELOG.md –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ docs/.

### 6. **__pycache__/** –∏ **sbis_token.json**
**–î–µ–π—Å—Ç–≤–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ .gitignore:
```gitignore
__pycache__/
*.pyc
sbis_token.json
tmp_images/
logs/
.env
```

---

## üöÄ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-3 –¥–Ω—è)

#### 1.1 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ build_native_xml()
- –†–∞–∑–±–∏—Ç—å –Ω–∞ 5-6 –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –î–æ–±–∞–≤–∏—Ç—å docstrings
- –ü–æ–∫—Ä—ã—Ç—å unit-—Ç–µ—Å—Ç–∞–º–∏

#### 1.2 –°–æ–∑–¥–∞—Ç—å config.py
- –í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ pydantic
```python
from pydantic import BaseSettings

class Settings(BaseSettings):
    telegram_bot_token: str
    openai_api_key: str
    sbis_inn: str
    warehouse_name: str
    
    class Config:
        env_file = ".env"

settings = Settings()
```

#### 1.3 –î–æ–±–∞–≤–∏—Ç—å retry-–ª–æ–≥–∏–∫—É –¥–ª—è OpenAI
```bash
pip install tenacity
```

#### 1.4 –ò—Å–ø—Ä–∞–≤–∏—Ç—å race conditions
- –î–æ–±–∞–≤–∏—Ç—å Lock –¥–ª—è USER_STATE
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è state

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (5-7 –¥–Ω–µ–π)

#### 2.1 –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ webhooks
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å nginx + SSL
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å python-telegram-bot.ext.Application
- –î–æ–±–∞–≤–∏—Ç—å health-check endpoint

#### 2.2 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Excel
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å lazy loading
- –î–æ–±–∞–≤–∏—Ç—å hot-reload –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤

#### 2.3 Unit-—Ç–µ—Å—Ç—ã
- –ü–æ–∫—Ä—ã—Ç–∏–µ >70% –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- CI/CD —Å –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

#### 2.4 Proper logging
```python
import logging
from logging.handlers import RotatingFileHandler

logger = logging.getLogger(__name__)
handler = RotatingFileHandler("logs/bot.log", maxBytes=10_000_000, backupCount=5)
formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)
logger.setLevel(logging.INFO)
```

#### 2.5 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```python
# middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
def error_handler(update, context):
    logger.error(f"Exception: {context.error}", exc_info=True)
    chat_id = update.effective_chat.id
    send_message(chat_id, "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ /start")

app.add_error_handler(error_handler)
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 3.1 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
```python
# SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è:
# - –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–æ–≤
# - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º
# - –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

#### 3.2 –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –±–µ–∑ Excel
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### 3.3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å monitoring
```python
# Prometheus + Grafana
from prometheus_client import Counter, Histogram

ocr_requests = Counter('ocr_requests_total', 'Total OCR requests')
ocr_duration = Histogram('ocr_duration_seconds', 'OCR duration')
```

#### 3.4 Multi-language support
```python
# i18n —á–µ—Ä–µ–∑ babel
from babel import support

translations = support.Translations.load('locale', ['ru', 'en'])
_ = translations.gettext

send_message(chat_id, _("Hello! I am a bot..."))
```

#### 3.5 –î–æ–∫–µ—Ä–∏–∑–∞—Ü–∏—è
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["python", "bot_simple.py"]
```

---

## üìà –ù–æ–≤—ã–µ —Ñ–∏—á–∏

### –§–∏—á–∞ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
**–°–µ–π—á–∞—Å:** –¢–∏–ø –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ ("–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ", "–°–ø–∏—Å–∞–Ω–∏–µ").  
**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ GPT:
```python
def detect_doc_type_smart(items: List[Dict], image_context: str) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø–æ:
    - –ù–∞–ª–∏—á–∏—é —Ü–µ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å ‚Üí –ø—Ä–∏—Ö–æ–¥)
    - –ö–æ–Ω—Ç–µ–∫—Å—Ç—É (–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "–≤—ã–ø—É—Å–∫", "—Å–ø–∏—Å–∞–Ω–∏–µ", "–ø—Ä–∏—Ö–æ–¥")
    - ML-–º–æ–¥–µ–ª—å –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏
    """
    ...
```

### –§–∏—á–∞ 2: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –ø–æ –∏–Ω–¥–µ–∫—Å—É
**–°–µ–π—á–∞—Å:** –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ GPT-—Ñ—Ä–∞–∑—ã ("—Ç–µ—Å—Ç–æ –Ω–µ 2, –∞ 3").  
**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–∏–∑–º–µ–Ω–∏—Ç—å 3"
–ë–æ—Ç: "–ü–æ–∑–∏—Ü–∏—è 3: –¢–ï–°–¢–û ‚Äî 2 –∫–≥. –í–≤–µ–¥–∏ –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ:"
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "3.5"
–ë–æ—Ç: "–ò–∑–º–µ–Ω–µ–Ω–æ: –¢–ï–°–¢–û ‚Äî 3.5 –∫–≥"
```

### –§–∏—á–∞ 3: –®–∞–±–ª–æ–Ω—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "/template –Ω–∞–≥–≥–µ—Ç—Å—ã"
–ë–æ—Ç: "–ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω '–ù–∞–≥–≥–µ—Ç—Å—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç':
  1. –ù–ê–ì–ì–ï–¢–°–´ ‚Äî 10
  2. –°–û–£–° –ö–ò–°–õ–û-–°–õ–ê–î–ö–ò–ô ‚Äî 2
  3. –£–ü–ê–ö–û–í–ö–ê ‚Äî 10
–û—Ç–ø—Ä–∞–≤–∏—Ç—å?"
```

### –§–∏—á–∞ 4: –ò—Å—Ç–æ—Ä–∏—è –∏ –ø–æ–≤—Ç–æ—Ä –ø—Ä–æ—à–ª—ã—Ö –∞–∫—Ç–æ–≤
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "/history"
–ë–æ—Ç: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç—ã:
  1. 12.12 - –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, 5 –ø–æ–∑–∏—Ü–∏–π
  2. 11.12 - –°–ø–∏—Å–∞–Ω–∏–µ, 8 –ø–æ–∑–∏—Ü–∏–π
  3. 10.12 - –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, 3 –ø–æ–∑–∏—Ü–∏–∏"
  
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "/repeat 1"
–ë–æ—Ç: "–ü–æ–≤—Ç–æ—Ä—è—é –∞–∫—Ç –æ—Ç 12.12. –û—Ç–ø—Ä–∞–≤–∏—Ç—å?"
```

### –§–∏—á–∞ 5: –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 5 —Ñ–æ—Ç–æ —Å—Ä–∞–∑—É]
–ë–æ—Ç: "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é 5 —Ç–∞–±–ª–∏—Ü...
–ì–æ—Ç–æ–≤–æ! –í—Å–µ–≥–æ 23 –ø–æ–∑–∏—Ü–∏–∏. –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫?"
```

### –§–∏—á–∞ 6: –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF/Excel
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "/export excel"
–ë–æ—Ç: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª] "–í–æ—Ç —Ç–≤–æ–π –∞–∫—Ç –≤ Excel"
```

### –§–∏—á–∞ 7: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –≤ –°–ë–ò–°
```
–ë–æ—Ç (—á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã): "‚úÖ –ê–∫—Ç ‚Ññ123 –æ—Ç 13.12 –ø—Ä–∏–Ω—è—Ç –°–ë–ò–°. –ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞: –í–ù-00001234"
```

### –§–∏—á–∞ 8: –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≥–æ–ª–æ—Å–æ–≤–æ–µ] "–ø–æ–∫–∞–∂–∏ —Å–ø–∏—Å–æ–∫"
–ë–æ—Ç: [—Ç–µ–∫—Å—Ç] "–¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫: ..."

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≥–æ–ª–æ—Å–æ–≤–æ–µ] "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–∫—Ç"
–ë–æ—Ç: "–û—Ç–ø—Ä–∞–≤–ª—è—é..."
```

### –§–∏—á–∞ 9: –ú—É–ª—å—Ç–∏—é–∑–µ—Ä + —Ä–æ–ª–∏
```python
# –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞:
# - admin: –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∞–∫—Ç—ã, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥
# - manager: –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–∫—Ç—ã, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
# - viewer: —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
```

### –§–∏—á–∞ 10: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- 1–° —á–µ—Ä–µ–∑ REST API
- Google Sheets –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ (–≤–º–µ—Å—Ç–æ Excel)
- Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä—É

---

## üìù –ü–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (roadmap)

### –ù–µ–¥–µ–ª—è 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç
- [ ] –°–æ–∑–¥–∞—Ç—å config.py —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å utils.py (to_float_safe, validate_date, validate_inn)
- [ ] –†–∞–∑–±–∏—Ç—å build_native_xml() –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –£–¥–∞–ª–∏—Ç—å –º—É—Å–æ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã
- [ ] –û–±–Ω–æ–≤–∏—Ç—å .gitignore

### –ù–µ–¥–µ–ª—è 2: –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å type hints –≤–µ–∑–¥–µ
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å proper logging
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å 20-30 unit-—Ç–µ—Å—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry-–ª–æ–≥–∏–∫—É –¥–ª—è OpenAI
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å race conditions

### –ù–µ–¥–µ–ª—è 3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ webhooks
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Excel
- [ ] –†–∞–∑–±–∏—Ç—å bot_simple.py –Ω–∞ handlers
- [ ] –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –æ—à–∏–±–æ–∫

### –ù–µ–¥–µ–ª—è 4: –ù–æ–≤—ã–µ —Ñ–∏—á–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–æ–≤ (SQLite)
- [ ] –®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É
- [ ] –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: **7/10** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

**–ü–ª—é—Å—ã:**
- ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–π MVP
- ‚úÖ –•–æ—Ä–æ—à–∞—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤
- ‚ùå Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è
- ‚ùå –ù–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞: **9/10** üöÄ

---

## üìö –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞

1. **Clean Code** by Robert Martin - –ø—Ä–æ SRP, DRY, KISS
2. **Refactoring** by Martin Fowler - –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
3. **Architecture Patterns with Python** - –ø—Ä–æ layered architecture
4. **Python Best Practices** - PEP8, type hints, docstrings

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∞—É–¥–∏—Ç—É –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π - –ø–∏—à–∏ –≤ —á–∞—Ç!

**–ê–≤—Ç–æ—Ä –∞—É–¥–∏—Ç–∞:** GitHub Copilot  
**GitHub:** https://github.com/vipfat/Sbis_Yen
